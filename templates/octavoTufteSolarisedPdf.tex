% tufte-handout.tex - DESC
% Iago Mosqueira - JRC. 2013
% Updated by Ian Hocking 2016
%
\documentclass[$if(fontsize)$$fontsize$,$endif$$if(lang)$$babel-lang$,$endif$$if(papersize)$$papersize$paper,$endif$$for(classoption)$$classoption$$sep$,$endfor$]{tufte-handout}

%This ensures maketitle will not include a date
\date{}

% For color boxes
\usepackage[most]{tcolorbox}
\tcbuselibrary{skins}
\tcbuselibrary{breakable}

% For coloured swatches
\newcommand\crule[3][black]{\textcolor{#1}{\rule{#2}{#3}}}




% IH added this:
% longtable
\usepackage{longtable}

 \usepackage{comment} % For hidden comments

\usepackage{framed}

% IH added this to stop the error 'Argument of \MakeTextLowercase has an extra }
\def\tightlist{}

% IH added this - apparently it improves kerning etc.
\usepackage{microtype}

\usepackage{fontspec}

$if(mainfont)$
\setmainfont{$mainfont$}% IH added this to make the template honour 'mainfont'
$endif$

% Set up the spacing using fontspec features
\renewcommand\allcapsspacing[1]{{\addfontfeature{LetterSpace=15}#1}}
\renewcommand\smallcapsspacing[1]{{\addfontfeature{LetterSpace=10}#1}}

% A package that will add nice chapter opening pages
% \usepackage[grey,utopia]{quotchap}
% ams
\usepackage{amssymb,amsmath}

% Set up the images/graphics package
\usepackage{graphicx}
\setkeys{Gin}{width=\linewidth,totalheight=\textheight,keepaspectratio}
\graphicspath{{graphics/}}

% natbib
\usepackage{natbib}
\bibliographystyle{plainnat}

% biblatex
$if(biblatex)$
\usepackage{biblatex}
$if(biblio-files)$
\bibliography{$biblio-files$}
$endif$
$endif$

% multiplecol
%\usepackage{multicol}



% For nice quotes
\usepackage{epigraph}

% booktabs
\usepackage{booktabs}
\usepackage{array}% http://ctan.org/pkg/array
%\setlength{\defaultaddspace}{2em}% Adjusted line spacing
\setlength{\extrarowheight}{5pt}
\let\originaltoprule\toprule

% url
\usepackage{url}

% qr codes!
\usepackage[nolinks]{qrcode}


% hyperref
\usepackage{hyperref}
% Next three lines added by IH
% to make sure links are colored
$if(colorlinks)$
\PassOptionsToPackage{usenames,dvipsnames}{color} % color is loaded by hyperref
$endif$



% units.
\usepackage{units}

% fancyvrb
\usepackage{fancyvrb}
\fvset{fontsize=\normalsize}
\DefineShortVerb[commandchars=\\\{\}]{\|}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}


% multiplecol
\usepackage{multicol}

% lipsum
\usepackage{lipsum}

% These commands are used to pretty-print LaTeX commands
\newcommand{\doccmd}[1]{\texttt{\textbackslash#1}}% command name -- adds backslash automatically
\newcommand{\docopt}[1]{\ensuremath{\langle}\textrm{\textit{#1}}\ensuremath{\rangle}}% optional command argument
\newcommand{\docarg}[1]{\textrm{\textit{#1}}}% (required) command argument
\newenvironment{docspec}{\begin{quote}\noindent}{\end{quote}}% command specification environment
\newcommand{\docenv}[1]{\textsf{#1}}% environment name
\newcommand{\docpkg}[1]{\texttt{#1}}% package name
\newcommand{\doccls}[1]{\texttt{#1}}% document class name
\newcommand{\docclsopt}[1]{\texttt{#1}}% document class option name

% Shaded
% \newenvironment{Shaded}{}{}
% \newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
% \newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.56,0.13,0.00}{{#1}}}
% \newcommand{\DecValTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
% \newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
% \newcommand{\FloatTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
% \newcommand{\CharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
% \newcommand{\StringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
% \newcommand{\CommentTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textit{{#1}}}}
% \newcommand{\OtherTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{{#1}}}
% \newcommand{\AlertTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
% \newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.02,0.16,0.49}{{#1}}}
% \newcommand{\RegionMarkerTok}[1]{{#1}}
% \newcommand{\ErrorTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
% \newcommand{\NormalTok}[1]{{#1}}




%%%%%%%%
%% Next bit added by IH 2 May
\hypersetup{unicode=true,
$if(title-meta)$
            pdftitle={$title-meta$},
$endif$
$if(author-meta)$
            pdfauthor={$author-meta$},
$endif$
$if(keywords)$
            pdfkeywords={$for(keywords)$$keywords$$sep$; $endfor$},
$endif$
            breaklinks=false}      
$if(lang)$
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[shorthands=off,$for(babel-otherlangs)$$babel-otherlangs$,$endfor$main=$babel-lang$]{babel}
$if(babel-newcommands)$
  $babel-newcommands$
$endif$
\else
  \usepackage{polyglossia}
  \setmainlanguage[$polyglossia-lang.options$]{$polyglossia-lang.name$}
$for(polyglossia-otherlangs)$
  \setotherlanguage[$polyglossia-otherlangs.options$]{$polyglossia-otherlangs.name$}
$endfor$
\fi
$endif$
%%%%%%%%%

\urlstyle{sf}  % don't use monospace font for urls

$if(boxlinks)$
%Change behaviour of href so that it uses boxexturl
\let\oldhref\href
\renewcommand{\href}[2]{\boxexturl{\oldhref{#1}{#2}}}

%Change behaviour of href so that it uses boxexturl
\let\oldhyperlink\hyperlink
\renewcommand{\hyperlink}[2]{\boxinturl{\oldhyperlink{#1}{#2}}}
$endif$

$if(numbersections)$
\setcounter{secnumdepth}{5}
$else$
\setcounter{secnumdepth}{0}
$endif$


$if(title)$
\title{$title$ \\ \small $subtitle$}
$endif$
$if(author)$
\author{$for(author)$$author$$sep$ \and $endfor$}
$endif$

\interfootnotelinepenalty=10000 % Should stop footnotes being broken across pages

$if(linespread)$
\linespread{$linespread$} % a bit more space between paras
$endif$


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% SOLARISED DARK BEGINS
% Using the Solarised package from here: http://ethanschoonover.com/solarized
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Creates a new command that allows us to set global
% colour (affects text, but may also affect things like fleurons!)
\makeatletter
\newcommand{\globalcolor}[1]{%
  \color{#1}\global\let\default@color\current@color
}
\makeatother

\definecolor{base03}{RGB}{0,43,54}
\definecolor{base02}{RGB}{7,54,66}
\definecolor{base01}{RGB}{88,110,117}
\definecolor{base00}{RGB}{101,123,131}
\definecolor{base0}{RGB}{131,148,150}
\definecolor{base1}{RGB}{147,161,161}
\definecolor{base2}{RGB}{238,232,213}
\definecolor{base3}{RGB}{253,246,227}
\definecolor{yellow}{RGB}{181,137,0}
\definecolor{orange}{RGB}{203,75,22}
\definecolor{red}{RGB}{220,50,47}
\definecolor{magenta}{RGB}{211,54,130}
\definecolor{violet}{RGB}{108,113,196}
\definecolor{blue}{RGB}{38,139,210}
\definecolor{cyan}{RGB}{42,161,152}
\definecolor{green}{RGB}{133,153,0}

% My own colour names
\definecolor{colourRich}{RGB}{129, 67, 116} % like cyan
\definecolor{colourMellow}{RGB}{203,75,22} % like orange 
\definecolor{colourSoothing}{RGB}{181,137,0} % like yellow
\definecolor{colourLight}{RGB}{131,148,150} % like base0
\definecolor{colourPaper}{RGB}{0,43,54}  % like base03
\definecolor{colourDark}{RGB}{7,54,66} %  like base02

\renewcommand{\familydefault}{\sfdefault} % sans serif now, since this is about accessibility
% \color{base0} % body text colour
\AtBeginDocument{\globalcolor{base0}} % switch main colour to white(ish)
\pagecolor{base03} % background colour

\newtcbox{\boxexturl}{fontupper=\ttfamily,enhanced,nobeforeafter,tcbox raise base,boxrule=0.4pt,top=0mm,bottom=0mm,
  right=0mm,left=4mm,arc=1pt,boxsep=2pt,before upper={\vphantom{dlg}},
  colframe=colourMellow,coltext=colourLight,colback=colourPaper!50!colourDark,
  overlay={\begin{tcbclipinterior}\fill[colourMellow] (frame.south west)
    rectangle node[text=colourPaper,font=\sffamily\bfseries\tiny,rotate=90] {GO} ([xshift=4mm]frame.north west);\end{tcbclipinterior}}}

% Email box is currently unused
\newtcbox{\boxemail}{fontupper=\ttfamily,enhanced,nobeforeafter,tcbox raise base,boxrule=0.4pt,top=0mm,bottom=0mm,
  right=0mm,left=4mm,arc=1pt,boxsep=2pt,before upper={\vphantom{dlg}},
colframe=colourMellow,coltext=colourLight,colback=colourPaper!50!colourDark,  overlay={\begin{tcbclipinterior}\fill[colourLight] (frame.south west)
    rectangle node[text=colourPaper,font=\sffamily\bfseries\tiny,rotate=90] {@} ([xshift=4mm]frame.north west);\end{tcbclipinterior}}}
    
\newtcbox{\boxinturl}{fontupper=\ttfamily,enhanced,nobeforeafter,tcbox raise base,boxrule=0.4pt,top=0mm,bottom=0mm,
  right=0mm,left=4mm,arc=1pt,boxsep=2pt,before upper={\vphantom{dlg}},
colframe=colourMellow,coltext=colourLight,colback=colourPaper!50!colourDark, overlay={\begin{tcbclipinterior}\fill[colourSoothing] (frame.south west)
    rectangle node[text=colourPaper,font=\sffamily\bfseries\tiny,rotate=90] {GO} ([xshift=4mm]frame.north west);\end{tcbclipinterior}}}

% Set up coloured 'call outs'
\tcbset{textmarker/.style={skin=enhancedmiddle jigsaw,breakable, boxrule=0mm,leftrule=5mm,rightrule=5mm,boxsep=0mm,arc=0mm,outer arc=0mm, left=3mm,right=3mm,top=4mm,bottom=4mm,toptitle=1mm,bottomtitle=1mm,oversize}}

\newtcolorbox{highlight}{enlarge top by=0.5cm,textmarker,colback=colourLight!5!colourPaper,colframe=colourLight,coltext=colourLight}

\newtcolorbox{task}{enlarge top by=0.5cm,textmarker,colback=colourSoothing!5!colourPaper,
colframe=colourSoothing,coltext=colourLight}

\newtcolorbox{journal}{enlarge top by=0.5cm,textmarker,colback=colourMellow!5!colourPaper,colframe=colourMellow,coltext=colourLight} 

% Set up 'answer boxes'
\tcbset{answerbox/.style={enlarge top by=0.5cm,enhanced jigsaw, breakable,title=Answer, colback=base02, colbacktitle=base00, colframe=base0,coltext=base1}}
\newtcolorbox{answer}{answerbox}

% Set up 'inline boxes'
\DeclareTotalTCBox{\inlineHyper}{ O{colourMellow} v O{} }
{ box align=base, fontupper=\ttfamily,nobeforeafter,tcbox raise base,arc=0pt,outer arc=0pt,
  top=0pt,bottom=0pt,left=0mm,right=0mm,
  leftrule=0pt,rightrule=0pt,toprule=0.2mm,bottomrule=0.2mm,boxsep=0.9mm,
  colback=#1!10!white,colframe=#1!50!black,#3}{#2}

\DeclareTotalTCBox{\inlineKeyword}{ O{colourSoothing} v O{} }
{ box align=base, fontupper=\ttfamily,nobeforeafter,tcbox raise base,arc=0pt,outer arc=0pt,
  top=0pt,bottom=0pt,left=0mm,right=0mm,
  leftrule=0pt,rightrule=0pt,toprule=0.2mm,bottomrule=0.2mm,boxsep=0.9mm,
  coltext=colourSoothing,colback=colourPaper!50!colourDark,colframe=#1!50!black,#3}{#2}

\DeclareTotalTCBox{\inlinePopout}{ O{colourSoothing} v O{} }
{ box align=base, fontupper=\ttfamily,nobeforeafter,tcbox raise base,arc=0pt,outer arc=0pt,
  top=0pt,bottom=0pt,left=0mm,right=0mm,
  leftrule=0pt,rightrule=0pt,toprule=0.2mm,bottomrule=0.2mm,boxsep=0.9mm,
  coltext=colourSoothing,colback=colourPaper!50!colourDark,colframe=#1!50!black,#3}{#2}

\DeclareTotalTCBox{\inlineDo}{ O{colourRich} v O{} }
{ box align=base, fontupper=\ttfamily,nobeforeafter,tcbox raise base,arc=2pt,outer arc=2pt,
  top=0pt,bottom=0pt,left=0mm,right=0mm,
  leftrule=0.2mm,rightrule=0.2mm,toprule=0.2mm,bottomrule=0.2mm,boxsep=0.9mm,
  coltext=colourSoothing,colback=colourPaper!50!colourDark,colframe=#1!50!black,#3}{#2}

\DeclareTotalTCBox{\inlineDo}{ s v } {verbatim,colupper=white,colback=colourRich,colframe=colourRich} {\IfBooleanTF{#1}{\textcolor{red}{\ttfamily\bfseries > }}{}
     \lstinline[]^#2^}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% SOLARISED DARK ENDS
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%




\begin{document}


%\large - Added by IH. For other sizes, see http://texblog.org/2012/08/29/changing-the-font-size-in-latex/
$if(title)$
\maketitle
$endif$

%\begin{flushleft} % Coloured swatches showing theme
%\crule[colourRich]{0.4cm}{0.25cm} \crule[colourMellow]{0.4cm}{0.25cm} \crule[colourSoothing]{0.4cm}{0.25cm} 

%\crule[colourLight]{0.4cm}{0.25cm} \crule[colourPaper]{0.4cm}{0.25cm} \crule[colourDark]{0.4cm}{0.25cm}  
%\end{flushleft}

%$if(date)$
%\date{$date$}
%$endif$

$if(headimage)$
%$headimage$
\begin{marginfigure}
\epigraph{$headquote$}{\textit{$headquoteauthor$}}
\end{marginfigure}
$endif$




% Next toc ... body added by IH
$if(toc)$
{
$if(colorlinks)$
\hypersetup{linkcolor=$if(toccolor)$$toccolor$$else$black$endif$}
$endif$
\setcounter{tocdepth}{$toc-depth$}
\tableofcontents
%\addtocontents{toc}{~\hfill\textbf{Page}\par} % added by IH
\addtocontents{toc}{~\hfill\par} % added by IH
}
$endif$
$if(lot)$
\listoftables
$endif$
$if(lof)$
\listoffigures
$endif$

$body$



$if(natbib)$
$if(biblio-files)$
$if(biblio-title)$
$if(book-class)$
\renewcommand\bibname{$biblio-title$}
$else$
\renewcommand\refname{$biblio-title$}
$endif$
$endif$
\bibliography{$biblio-files$}
\bibliographystyle{plainnat}

$endif$
$endif$
$if(biblatex)$
\printbibliography$if(biblio-title)$[title=$biblio-title$]$endif$

$endif$
$for(include-after)$
$include-after$

$endfor$

\end{document}
